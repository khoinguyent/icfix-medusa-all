import{K as S}from"./chunk-6HTZNHPT-xixTBg0F.js";import{b as u,u as w}from"./chunk-4TC5YS65-CPc1BBnN.js";import{af as R,ah as b,at as k,a0 as C,b as F,ec as I,ed as T,db as N,j as e,H as z,am as L,an as M,ee as V,t as _,y as s,aj as m,z as A,E as B,B as q,J as E}from"./index-sa816enF.js";var D=R({location_id:b(),description:b().optional(),quantity:k().min(1)}),h=({title:t,value:r})=>e.jsxs("div",{className:"grid grid-cols-2 divide-x",children:[e.jsx(E,{className:"px-2 py-1.5",size:"small",leading:"compact",children:t}),e.jsx(E,{className:"px-2 py-1.5",size:"small",leading:"compact",children:r})]}),H=t=>({quantity:t.quantity,location_id:t.location_id,description:t.description??void 0}),K=({reservation:t,item:r,locations:l})=>{const{t:a}=F(),{handleSuccess:y}=w(),o=L({defaultValues:H(t),resolver:M(D)}),{mutateAsync:n}=V(t.id),j=o.handleSubmit(async i=>{n(i,{onSuccess:()=>{_.success(a("inventory.reservation.updateSuccessToast")),y()},onError:x=>{_.error(x.message)}})}),p=o.watch("quantity"),v=o.watch("location_id"),c=r.location_levels.find(i=>i.location_id===v);return e.jsx(u.Form,{form:o,children:e.jsxs(S,{onSubmit:j,className:"flex flex-1 flex-col overflow-hidden",children:[e.jsxs(u.Body,{className:"flex flex-1 flex-col gap-y-8 overflow-auto",children:[e.jsx(s.Field,{control:o.control,name:"location_id",render:({field:{onChange:i,value:x,ref:f,...g}})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:a("inventory.reservation.location")}),e.jsx(s.Control,{children:e.jsxs(m,{value:x,onValueChange:d=>{i(d)},...g,children:[e.jsx(m.Trigger,{ref:f,children:e.jsx(m.Value,{})}),e.jsx(m.Content,{children:(l||[]).map(d=>e.jsx(m.Item,{value:d.id,children:d.name},d.id))})]})}),e.jsx(s.ErrorMessage,{})]})}),e.jsxs("div",{className:"text-ui-fg-subtle shadow-elevation-card-rest grid grid-rows-4 divide-y rounded-lg border",children:[e.jsx(h,{title:a("fields.title"),value:r.title??r.sku}),e.jsx(h,{title:a("fields.sku"),value:r.sku}),e.jsx(h,{title:a("fields.inStock"),value:c.stocked_quantity}),e.jsx(h,{title:a("inventory.available"),value:c.stocked_quantity-(c.reserved_quantity-t.quantity)-p})]}),e.jsx(s.Field,{control:o.control,name:"quantity",render:({field:{onChange:i,value:x,...f}})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:a("inventory.reservation.reservedAmount")}),e.jsx(s.Control,{children:e.jsx(A,{type:"number",min:0,max:(c.available_quantity||0)+(t.quantity||0),value:x||"",onChange:g=>{const d=g.target.value;i(d===""?null:parseFloat(d))},...f})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:o.control,name:"description",render:({field:i})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{optional:!0,children:a("fields.description")}),e.jsx(s.Control,{children:e.jsx(B,{...i})}),e.jsx(s.ErrorMessage,{})]})})]}),e.jsx(u.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(u.Close,{asChild:!0,children:e.jsx(q,{variant:"secondary",size:"small",children:a("actions.cancel")})}),e.jsx(q,{type:"submit",size:"small",isLoading:!1,children:a("actions.save")})]})})]})})},Q=()=>{var v;const{id:t}=C(),{t:r}=F(),{reservation:l,isPending:a,isError:y,error:o}=I(t),{inventory_item:n}=T(l==null?void 0:l.inventory_item_id,{enabled:!!l}),{stock_locations:j}=N({id:(v=n==null?void 0:n.location_levels)==null?void 0:v.map(c=>c.location_id)},{enabled:!!(n!=null&&n.location_levels)}),p=!a&&l&&n&&j;if(y)throw o;return e.jsxs(u,{children:[e.jsx(u.Header,{children:e.jsx(z,{children:r("inventory.reservation.editItemDetails")})}),p&&e.jsx(K,{locations:j,reservation:l,item:n})]})};export{Q as Component};
